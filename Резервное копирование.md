1. Установка и настройка https://yandex.cloud/ru-kz/docs/storage/tools/yc-cli
2. Создание бакета
3. Насройка скрипта

~~~~bash
#!/bin/bash

set -e

BACKUP_TIMESTAMP=$(date +%F_%H-%M)
BACKUP_DIR="/opt/backups/$BACKUP_TIMESTAMP"
mkdir -p "$BACKUP_DIR"

POSTGRES_CONTAINER="school-postgres-1"
POSTGRES_USER="school"
S3_BUCKET_NAME="baqylau"
BACKUP_ENV="dev"

# 1. Дамп базы
docker exec "$POSTGRES_CONTAINER" pg_dumpall -U "$POSTGRES_USER" > "$BACKUP_DIR/postgres.sql"

# 2. Архив папки storage
tar czf "$BACKUP_DIR/storage.tar.gz" -C /opt/school storage

# 3. Конфиги
cp /opt/school/docker-compose.yaml "$BACKUP_DIR/"

# 4. Отправка в облако
/root/yandex-cloud/bin/yc storage s3 cp --recursive "$BACKUP_DIR" "s3://$S3_BUCKET_NAME/$BACKUP_ENV-backups/$BACKUP_TIMESTAMP"

# 5. Чистим локальные старые бэкапы
find /opt/backups -type d -mtime +7 -exec rm -rf {} \;
~~~~

4. Настройка cron на запуск скрипта в 4 утра
~~~~
0 4 * * * /путь/до/твоего/скрипта.sh >> /var/log/backup.log 2>&1
~~~~